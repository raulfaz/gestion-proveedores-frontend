<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:p="http://primefaces.org/ui">

<ui:composition template="/templates/layout.xhtml">
    <ui:define name="title">Gestión de Proveedores</ui:define>
    <ui:define name="pageTitle">Proveedores</ui:define>

    <ui:define name="content">
        <h:form id="formProveedores">

            <!-- Toolbar -->
            <p:toolbar styleClass="mb-3">
                <p:toolbarGroup>
                    <p:commandButton value="Nuevo"
                                     icon="pi pi-plus"
                                     styleClass="p-button-success"
                                     onclick="PF('dlgProveedor').show();"
                                     action="#{proveedorBean.prepararNuevo()}"
                                     update=":formDialog"
                                     process="@this"/>

                    <p:commandButton value="Refrescar"
                                     icon="pi pi-refresh"
                                     action="#{proveedorBean.cargarProveedores()}"
                                     update="tablaProveedores"
                                     styleClass="p-button-info"/>
                </p:toolbarGroup>
            </p:toolbar>

            <!-- Tabla -->
            <p:dataTable id="tablaProveedores"
                         value="#{proveedorBean.proveedores}"
                         var="proveedor"
                         paginator="true"
                         rows="10"
                         emptyMessage="No hay proveedores registrados"
                         styleClass="tabla-proveedores"
                         stripedRows="true">

                <p:column headerText="ID" style="width: 80px;">
                    <h:outputText value="#{proveedor.id}"/>
                </p:column>

                <p:column headerText="RUC">
                    <h:outputText value="#{proveedor.ruc}"/>
                </p:column>

                <p:column headerText="Razón Social">
                    <h:outputText value="#{proveedor.razonSocial}"/>
                </p:column>

                <p:column headerText="Teléfono">
                    <h:outputText value="#{proveedor.telefono}"/>
                </p:column>

                <p:column headerText="Email">
                    <h:outputText value="#{proveedor.email}"/>
                </p:column>

                <p:column headerText="Estado" style="text-align: center;">
                    <p:tag value="#{proveedor.activo ? 'ACTIVO' : 'INACTIVO'}"
                           severity="#{proveedor.activo ? 'success' : 'danger'}"/>
                </p:column>

                <p:column headerText="Acciones" style="text-align: center; width: 150px;">
                    <p:commandButton icon="pi pi-pencil"
                                     title="Editar"
                                     styleClass="p-button-warning p-button-sm"
                                     onclick="PF('dlgProveedor').show();"
                                     action="#{proveedorBean.prepararEdicion(proveedor)}"
                                     update=":formDialog"
                                     process="@this"/>

                    <p:commandButton icon="pi pi-trash"
                                     title="Eliminar"
                                     styleClass="p-button-danger p-button-sm"
                                     action="#{proveedorBean.eliminar(proveedor)}"
                                     update="tablaProveedores"
                                     process="@this">
                        <p:confirm header="Confirmación"
                                   message="¿Eliminar este proveedor?"
                                   icon="pi pi-exclamation-triangle"/>
                    </p:commandButton>
                </p:column>
            </p:dataTable>

            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                <p:commandButton value="Sí" type="button" styleClass="ui-confirmdialog-yes"/>
                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no"/>
            </p:confirmDialog>
        </h:form>

        <!-- Dialog -->
        <h:form id="formDialog">
            <p:dialog id="dlgProveedor"
                      header="#{proveedorBean.modoEdicion ? 'Editar' : 'Nuevo'} Proveedor"
                      widgetVar="dlgProveedor"
                      modal="true"
                      width="600">

                <p:panelGrid columns="2" layout="grid">
                    <p:outputLabel for="ruc" value="RUC:"/>
                    <p:inputText id="ruc"
                                 value="#{proveedorBean.nuevoProveedor.ruc}"
                                 required="true"
                                 maxlength="13"/>

                    <p:outputLabel for="razonSocial" value="Razón Social:"/>
                    <p:inputText id="razonSocial"
                                 value="#{proveedorBean.nuevoProveedor.razonSocial}"
                                 required="true"
                                 maxlength="200"/>

                    <p:outputLabel for="telefono" value="Teléfono:"/>
                    <p:inputText id="telefono"
                                 value="#{proveedorBean.nuevoProveedor.telefono}"
                                 maxlength="20"/>

                    <p:outputLabel for="email" value="Email:"/>
                    <p:inputText id="email"
                                 value="#{proveedorBean.nuevoProveedor.email}"
                                 maxlength="100"/>

                    <p:outputLabel for="activo" value="Activo:"/>
                    <p:selectBooleanCheckbox id="activo"
                                             value="#{proveedorBean.nuevoProveedor.activo}"/>
                </p:panelGrid>

                <f:facet name="footer">
                    <p:commandButton value="Guardar"
                                     icon="pi pi-save"
                                     styleClass="p-button-success"
                                     action="#{proveedorBean.guardar()}"
                                     update=":formProveedores:tablaProveedores"
                                     oncomplete="if (!args.validationFailed) PF('dlgProveedor').hide();"/>

                    <p:commandButton value="Cancelar"
                                     icon="pi pi-times"
                                     onclick="PF('dlgProveedor').hide();"
                                     type="button"/>
                </f:facet>
            </p:dialog>
        </h:form>

        <f:metadata>
            <f:viewAction action="#{proveedorBean.init}"/>
        </f:metadata>
    </ui:define>
</ui:composition>